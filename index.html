<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizMaster - Kahoot Alternative</title>
    <style>
        :root {
            --primary-color: #8549ba;
            --secondary-color: #ff3355;
            --accent-color: #43c59e;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            margin: 0;
            flex-direction: column;
        }
        
        .header {
            width: 100%;
            height: 18vh;
            background-color: transparent;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .container {
            width: 100%;
            height: 82vh;
            background-color: transparent;
            border-radius: 0px;
            
            overflow: hidden;
            position: relative;
        }
        
        .screen {
            padding: 5vh 5vw;
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background-color: var(--light-color);
            z-index: 100;
            overflow-y: auto;
        }
        
        .screen.active {
            display: block;
        }
        
        .game-screen {
            padding: 5vh 5vw;
            display: none;
            height: 100%;
            overflow: hidden;
            position: relative;
        }
        
        .game-screen.active {
            display: block;
        }
        
        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 5vh;
            font-size: 3.5rem;
        }
        
        .subtitle {
            color: var(--dark-color);
            text-align: center;
            margin-bottom: 6vh;
            font-size: 1.8rem;
        }
        
        .input-group {
            margin-bottom: 4vh;
        }
        
        label {
            display: block;
            margin-bottom: 1.5vh;
            color: var(--dark-color);
            font-weight: 600;
            font-size: 1.4rem;
        }
        
        input, select {
            width: 100%;
            padding: 18px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.4rem;
            transition: border-color 0.3s;
            margin-bottom: 2vh;
        }
        
        input:focus, select:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 20px 25px;
            font-size: 1.6rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: block;
            width: 400px;
            height: 110px;
            margin-top: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            background-color: #6f3d9e;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
        }
        
        button.secondary {
            background-color: var(--secondary-color);
        }
        
        button.secondary:hover {
            background-color: #e12945;
        }
        
        button.accent {
            background-color: var(--accent-color);
        }
        
        button.accent:hover {
            background-color: #36a486;
        }
        
        .question-card {
            background-color: white;
            border-radius: 10px;
            padding: 40px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .answers {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 100px;
            margin-top: 2vh;
            height: 60vh;
            max-height: 500px;
            width: 100%;
            position: relative;
        }
        
        .timer-display {
            position: absolute;
            top: 66%;
            left: 51%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            font-weight: bold;
            color: var(--primary-color);
            z-index: 10;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .answer-btn {
            height: 100%;
            width: 100%;
            border-radius: 35px;
            font-size: 2.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            padding: 40px;
            background-color: transparent;
            border: 20px solid #8549ba;
            color: #333;
            margin: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .answer-btn span {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            line-height: 1.3;
            text-align: center;
        }
        
        .answer-btn:nth-child(1), .answer-btn:nth-child(2), .answer-btn:nth-child(3), .answer-btn:nth-child(4) {
            background-color: transparent;
            border: 4px solid #8549ba;
        }
        
        .answer-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .questions-list {
            margin-top: 30px;
        }
        
        .question-item {
            background-color: #f4f4f4;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }
        
        .question-item h3 {
            margin-bottom: 10px;
        }
        
        .correct-answer {
            color: var(--accent-color);
            font-weight: 600;
        }
        
        .remove-question {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .result-screen {
            text-align: center;
        }
        
        .score {
            font-size: 6rem;
            color: var(--primary-color);
            margin: 5vh 0;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .score-message {
            font-size: 2.2rem;
            margin-bottom: 5vh;
            font-weight: 500;
        }
        
        /* Settings screen scrolling */
        #settings-screen {
            overflow-y: hidden;
        }
        
        .settings-content {
            height: 100%;
            overflow-y: auto;
            padding-right: 15px;
        }
        
        @media (max-width: 768px) {
            .answers {
                grid-template-columns: 1fr;
                height: auto;
                max-height: none;
            }
            
            .answer-btn {
                height: 100px;
                margin-bottom: 15px;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            .subtitle {
                font-size: 1.4rem;
            }
            
            button {
                font-size: 1.4rem;
                padding: 15px 20px;
            }
            
            .score {
                font-size: 4rem;
            }
        }
        
        .virtual-keyboard {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
            margin: 0 auto;
            width: 90vw;
            height: 52vh;
            padding: 25px;
        }

        .key {
            background-color: white;
            border: 3px solid var(--primary-color);
            border-radius: 15px;
            padding: 0;
            font-size: 2.5rem;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .key.special, .key.delete {
            grid-column: span 2;
        }

        .key:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .key.special:hover {
            background-color: #36a486;
        }

        .key.delete:hover {
            background-color: #e12945;
        }

        .key.empty {
            border: none;
            pointer-events: none;
            background-color: transparent;
            visibility: hidden;
        }

        .key.delete {
            grid-column: span 2;
            background-color: var(--secondary-color);
            color: white;
        }

        .registration-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            height: 100vh;
            padding: 40px 20px;
        }

        .registration-content h2 {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .name-display {
            font-size: 3rem;
            color: var(--primary-color);
            margin: 20px 0;
            min-height: 3.5rem;
            text-align: center;
            position: relative;
            border: 3px solid var(--primary-color);
            border-radius: 15px;
            padding: 10px 20px;
            height: 100px;
            width: 700px;
        }

        .name-display::before {
            content: "Name";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ccc;
            font-size: 3rem;
            pointer-events: none;
            display: none;
        }

        .name-display:empty::before {
            display: block;
        }

        #question-text {
            font-size: 3.2rem;
            margin-bottom: 4vh;
            text-align: center;
            height: 15vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 20px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            line-height: 1.3;
        }

        .scoreboard {
            margin-top: 20px;
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            position: relative;
            z-index: 1;
        }

        .scoreboard h2 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.8rem;
            position: relative;
            z-index: 2;
        }

        .scoreboard-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            position: relative;
            z-index: 2;
        }

        .scoreboard-item {
            display: grid;
            grid-template-columns: 60px 1fr 100px 100px;
            align-items: center;
            padding: 8px 15px;
            background: #fff;
            border-radius: 10px;
            font-size: 1rem;
            height: 40px;
            min-height: 40px;
            position: relative;
            z-index: 2;
            color: #333;
        }

        .scoreboard-item.current-player {
            background: var(--primary-color);
            color: white;
        }

        .rank {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 0.9rem;
        }

        .current-player .rank {
            color: white;
        }

        .name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .score, .time {
            text-align: right;
            font-size: 0.9rem;
        }

        #play-again-btn {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            z-index: 102;
        }

        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .popup.active {
            display: flex;
        }

        .popup-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .popup-content h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 2rem;
        }

        .player-stats {
            margin: 20px 0;
        }

        .stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .stat:last-child {
            border-bottom: none;
        }

        .stat .label {
            font-size: 1.2rem;
            color: #666;
        }

        .stat .value {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        #close-popup-btn {
            width: 200px;
            margin-top: 20px;
        }

        #results-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background-color: var(--light-color);
            z-index: 100;
            overflow-y: auto;
            padding: 20px;
        }

        #results-screen.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="header">
        <!-- Transparent header without text -->
    </div>
    <div class="container">
        <div class="timer-display" id="timer-display">20</div>
        
        <!-- Game Screen -->
        <div class="game-screen" id="game-screen">
            <h2 id="question-text" style="font-size: 2.5rem; margin-bottom: 4vh; text-align: center;">Question text goes here?</h2>
            <div class="answers">
                <div class="answer-btn" data-index="0">Answer 1</div>
                <div class="answer-btn" data-index="1">Answer 2</div>
                <div class="answer-btn" data-index="2">Answer 3</div>
                <div class="answer-btn" data-index="3">Answer 4</div>
            </div>
        </div>
    </div>
    
    <!-- Full Screen Screens -->
    <!-- Registration Screen -->
    <div class="screen active" id="registration-screen">
        <div class="registration-content">
            <h2 style="color: var(--primary-color); text-align: center; margin-bottom: 30px; font-size: 2.5rem;">Welcome to QuizMaster!</h2>
            
            <div class="name-display" id="name-display"></div>
            
            <div class="virtual-keyboard">
                <!-- First row -->
                <div class="key">Q</div>
                <div class="key">W</div>
                <div class="key">E</div>
                <div class="key">R</div>
                <div class="key">T</div>
                <div class="key">Y</div>
                <div class="key">U</div>
                <div class="key">I</div>
                <div class="key">O</div>
                <div class="key">P</div>
                <div class="key">Ğ</div>
                <div class="key">Ü</div>
                <!-- Second row -->
                <div class="key">A</div>
                <div class="key">S</div>
                <div class="key">D</div>
                <div class="key">F</div>
                <div class="key">G</div>
                <div class="key">H</div>
                <div class="key">J</div>
                <div class="key">K</div>
                <div class="key">L</div>
                <div class="key">Ş</div>
                <div class="key">İ</div>
                <div class="key empty"></div>
                <!-- Third row -->
                <div class="key">Z</div>
                <div class="key">X</div>
                <div class="key">C</div>
                <div class="key">V</div>
                <div class="key">B</div>
                <div class="key">N</div>
                <div class="key">M</div>
                <div class="key">Ö</div>
                <div class="key">Ç</div>
                <div class="key empty"></div>
                <div class="key delete">Delete</div>
            </div>
            
            <button id="start-btn" style="margin-top: 30px;">Let's Start!</button>
        </div>
    </div>
    
    <!-- Waiting Screen -->
    <div class="screen" id="waiting-screen">
        <h1>Get Ready!</h1>
        <p class="subtitle">Waiting for the quiz to start...</p>
        <p id="player-display" style="text-align: center; font-size: 1.3rem; margin-bottom: 30px;"></p>
    </div>
    
    <!-- Results Screen -->
    <div class="screen" id="results-screen">
        <div class="scoreboard">
            <h2>Top Players</h2>
            <div class="scoreboard-list">
                <!-- Scoreboard items will be added here dynamically -->
            </div>
        </div>
        <button id="play-again-btn" style="margin: 40px auto;">Play Again</button>
    </div>

    <!-- Current Player Results Popup -->
    <div class="popup" id="current-player-popup">
        <div class="popup-content">
            <h2>Your Results</h2>
            <div class="player-stats">
                <div class="stat">
                    <span class="label">Score:</span>
                    <span class="value" id="current-score">0/0</span>
                </div>
                <div class="stat">
                    <span class="label">Time:</span>
                    <span class="value" id="current-time">0:00</span>
                </div>
                <div class="stat">
                    <span class="label">Rank:</span>
                    <span class="value" id="current-rank">#0</span>
                </div>
            </div>
            <button id="close-popup-btn">Continue</button>
        </div>
    </div>
    
    <!-- Settings Screen -->
    <div class="screen" id="settings-screen">
        <div class="settings-content">
            <h1>Quiz Settings</h1>
            <p class="subtitle">Customize your quiz questions</p>
            
            <div class="input-group">
                <label for="time-per-question">Time per Question (seconds)</label>
                <input type="number" id="time-per-question" min="5" max="60" value="20">
            </div>
            
            <div class="input-group">
                <label for="text-size">Text Size</label>
                <select id="text-size">
                    <option value="small">Small</option>
                    <option value="medium" selected>Medium</option>
                    <option value="large">Large</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="question-text-input">Question</label>
                <input type="text" id="question-text-input" placeholder="Enter your question">
            </div>
            
            <div class="input-group">
                <label>Answer Options</label>
                <input type="text" class="answer-input" placeholder="Answer 1" data-index="0" style="margin-bottom: 10px;">
                <input type="text" class="answer-input" placeholder="Answer 2" data-index="1" style="margin-bottom: 10px;">
                <input type="text" class="answer-input" placeholder="Answer 3" data-index="2" style="margin-bottom: 10px;">
                <input type="text" class="answer-input" placeholder="Answer 4" data-index="3">
            </div>
            
            <div class="input-group">
                <label for="correct-answer">Correct Answer</label>
                <select id="correct-answer">
                    <option value="0">Answer 1</option>
                    <option value="1">Answer 2</option>
                    <option value="2">Answer 3</option>
                    <option value="3">Answer 4</option>
                </select>
            </div>
            
            <button id="add-question-btn" class="accent">Add Question</button>
            
            <h2 style="margin-top: 40px; margin-bottom: 20px;">Quiz Questions</h2>
            <div id="questions-list" class="questions-list">
                <!-- Questions will be added here dynamically -->
            </div>
            
            <button id="save-settings-btn" style="margin-top: 30px;">Save & Start Quiz</button>
        </div>
    </div>

    <script>
        // Global variables
        let currentScreen = 'registration';
        let playerName = '';
        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let timer;
        let timeLeft;
        let timePerQuestion = 20; // Default time per question in seconds
        let totalTime = 0;
        let gameStartTime;
        let playerScores = JSON.parse(localStorage.getItem('playerScores')) || [];
        
        // DOM Elements
        const registrationScreen = document.getElementById('registration-screen');
        const waitingScreen = document.getElementById('waiting-screen');
        const gameScreen = document.getElementById('game-screen');
        const resultsScreen = document.getElementById('results-screen');
        const settingsScreen = document.getElementById('settings-screen');
        
        // Make the app fullscreen
        function resizeApp() {
            const container = document.querySelector('.container');
            const header = document.querySelector('.header');
            const windowHeight = window.innerHeight;
            
            // Make sure header is 25% of viewport height
            header.style.height = (windowHeight * 0.25) + 'px';
            
            // Make container take remaining space (minus margin)
            container.style.height = (windowHeight * 0.7) + 'px';
        }
        
        // Call on load and when window is resized
        window.addEventListener('load', resizeApp);
        window.addEventListener('resize', resizeApp);
        
        const playerNameInput = document.getElementById('player-name');
        const startBtn = document.getElementById('start-btn');
        const playerDisplay = document.getElementById('player-display');
        const questionText = document.getElementById('question-text');
        const answerBtns = document.querySelectorAll('.answer-btn');
        const finalScore = document.getElementById('final-score');
        const scoreMessage = document.getElementById('score-message');
        const playAgainBtn = document.getElementById('play-again-btn');
        const timePerQuestionInput = document.getElementById('time-per-question');
        const questionTextInput = document.getElementById('question-text-input');
        const answerInputs = document.querySelectorAll('.answer-input');
        const correctAnswerSelect = document.getElementById('correct-answer');
        const addQuestionBtn = document.getElementById('add-question-btn');
        const questionsList = document.getElementById('questions-list');
        const saveSettingsBtn = document.getElementById('save-settings-btn');
        const timerDisplay = document.getElementById('timer-display');
        
        // Event Listeners
        startBtn.addEventListener('click', startGame);
        playAgainBtn.addEventListener('click', resetGame);
        addQuestionBtn.addEventListener('click', addQuestion);
        saveSettingsBtn.addEventListener('click', saveSettings);
        
        answerBtns.forEach(btn => {
            btn.addEventListener('click', () => selectAnswer(parseInt(btn.dataset.index)));
        });
        
        // Keyboard listener for Ctrl key to access settings
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Control') {
                if (currentScreen === 'settings') {
                    showScreen('registration');
                } else {
                    showScreen('settings');
                }
            }
        });
        
        // Functions
        function showScreen(screenName) {
            // Hide all screens
            registrationScreen.classList.remove('active');
            waitingScreen.classList.remove('active');
            gameScreen.classList.remove('active');
            resultsScreen.classList.remove('active');
            settingsScreen.classList.remove('active');
            
            // Hide timer display by default
            document.getElementById('timer-display').style.display = 'none';
            
            // Show the requested screen
            switch(screenName) {
                case 'registration':
                    registrationScreen.classList.add('active');
                    break;
                case 'waiting':
                    waitingScreen.classList.add('active');
                    break;
                case 'game':
                    gameScreen.classList.add('active');
                    document.getElementById('timer-display').style.display = 'block';
                    break;
                case 'results':
                    resultsScreen.classList.add('active');
                    break;
                case 'settings':
                    settingsScreen.classList.add('active');
                    break;
            }
            
            currentScreen = screenName;
        }
        
        function startGame() {
            playerName = nameDisplay.textContent.trim();
            
            if (!playerName) {
                alert('Please enter your name to continue!');
                return;
            }
            
            if (questions.length === 0) {
                // Add some default questions if none exist
                questions = [
                    {
                        question: "What's the capital of France?",
                        answers: ["Berlin", "Paris", "London", "Madrid"],
                        correctAnswer: 1
                    },
                    {
                        question: "Which planet is known as the Red Planet?",
                        answers: ["Earth", "Venus", "Mars", "Jupiter"],
                        correctAnswer: 2
                    },
                    {
                        question: "Who painted the Mona Lisa?",
                        answers: ["Vincent van Gogh", "Leonardo da Vinci", "Pablo Picasso", "Michelangelo"],
                        correctAnswer: 1
                    }
                ];
                renderQuestionsList();
            }
            
            playerDisplay.textContent = `Player: ${playerName}`;
            showScreen('waiting');
            
            // Simulate waiting for other players
            setTimeout(() => {
                startQuiz();
            }, 2000);
        }
        
        // Function to shuffle array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Function to shuffle answers while keeping track of correct answer
        function shuffleAnswers(question) {
            const answers = [...question.answers];
            const correctAnswer = answers[question.correctAnswer];
            
            // Shuffle the answers array
            shuffleArray(answers);
            
            // Find the new index of the correct answer
            const newCorrectIndex = answers.indexOf(correctAnswer);
            
            return {
                question: question.question,
                answers: answers,
                correctAnswer: newCorrectIndex
            };
        }

        function startQuiz() {
            // Shuffle questions
            questions = shuffleArray([...questions]);
            
            // Shuffle answers for each question
            questions = questions.map(shuffleAnswers);
            
            currentQuestionIndex = 0;
            score = 0;
            totalTime = 0;
            gameStartTime = Date.now();
            showQuestion();
        }
        
        function showQuestion() {
            if (currentQuestionIndex >= questions.length) {
                endQuiz();
                return;
            }
            
            const question = questions[currentQuestionIndex];
            questionText.textContent = question.question;
            
            answerBtns.forEach((btn, index) => {
                const span = document.createElement('span');
                span.textContent = question.answers[index];
                btn.innerHTML = '';
                btn.appendChild(span);
                btn.style.backgroundColor = 'transparent';
                btn.style.color = '#333';
                btn.style.pointerEvents = 'auto';
            });
            
            showScreen('game');
            startTimer();
        }
        
        function startTimer() {
            timeLeft = timePerQuestion;
            const timerDisplay = document.getElementById('timer-display');
            timerDisplay.textContent = timeLeft;
            
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    timeOut();
                }
            }, 1000);
        }
        
        function timeOut() {
            // Highlight the correct answer
            const correctIndex = questions[currentQuestionIndex].correctAnswer;
            answerBtns[correctIndex].style.backgroundColor = '#8549ba'; // Purple for correct
            answerBtns[correctIndex].style.color = 'white';
            
            // Disable clicking on answers
            answerBtns.forEach(btn => {
                btn.style.pointerEvents = 'none';
            });
            
            // Move to next question after a delay
            setTimeout(() => {
                currentQuestionIndex++;
                showQuestion();
            }, 1500);
        }
        
        function selectAnswer(answerIndex) {
            clearInterval(timer);
            
            const correctIndex = questions[currentQuestionIndex].correctAnswer;
            
            // Highlight the correct answer by filling it with purple
            answerBtns[correctIndex].style.backgroundColor = '#8549ba';
            answerBtns[correctIndex].style.color = 'white';
            
            // If selected answer is incorrect, add a subtle red background
            if (answerIndex !== correctIndex) {
                answerBtns[answerIndex].style.backgroundColor = 'rgba(255, 51, 85, 0.3)';
            } else {
                // If correct, increase score
                score++;
            }
            
            // Disable clicking on answers
            answerBtns.forEach(btn => {
                btn.style.pointerEvents = 'none';
            });
            
            // Move to next question after a delay
            setTimeout(() => {
                currentQuestionIndex++;
                showQuestion();
            }, 1500);
        }
        
        function endQuiz() {
            totalTime = Math.floor((Date.now() - gameStartTime) / 1000); // Convert to seconds
            
            // Add current player's score
            const currentPlayerScore = {
                name: playerName,
                score: score,
                time: totalTime,
                date: new Date().toLocaleDateString()
            };
            
            playerScores.push(currentPlayerScore);
            
            // Sort scores: first by score (descending), then by time (ascending)
            playerScores.sort((a, b) => {
                if (b.score !== a.score) {
                    return b.score - a.score;
                }
                return a.time - b.time;
            });
            
            // Keep only top 10 scores
            playerScores = playerScores.slice(0, 10);
            
            // Save to localStorage
            localStorage.setItem('playerScores', JSON.stringify(playerScores));
            
            // Update scoreboard
            updateScoreboard();
            
            // Show current player results popup
            showCurrentPlayerResults(currentPlayerScore);
            
            showScreen('results');
        }
        
        function showCurrentPlayerResults(playerScore) {
            const popup = document.getElementById('current-player-popup');
            const currentScore = document.getElementById('current-score');
            const currentTime = document.getElementById('current-time');
            const currentRank = document.getElementById('current-rank');
            
            // Find player's rank
            const rank = playerScores.findIndex(score => 
                score.name === playerScore.name && 
                score.score === playerScore.score && 
                score.time === playerScore.time
            ) + 1;
            
            currentScore.textContent = `${playerScore.score}/${questions.length}`;
            currentTime.textContent = formatTime(playerScore.time);
            currentRank.textContent = `#${rank}`;
            
            popup.classList.add('active');
        }
        
        function updateScoreboard() {
            const scoreboardHTML = playerScores.slice(0, 10).map((score, index) => `
                <div class="scoreboard-item">
                    <span class="rank">#${index + 1}</span>
                    <span class="name">${score.name}</span>
                    <span class="score">${score.score}/${questions.length}</span>
                    <span class="time">${formatTime(score.time)}</span>
                </div>
            `).join('');
            // DEBUG: log playerScores and HTML
            console.log('playerScores:', playerScores);
            console.log('scoreboardHTML:', scoreboardHTML);
            // Update scoreboard content
            const scoreboardList = document.querySelector('.scoreboard-list');
            if (scoreboardList) {
                scoreboardList.innerHTML = scoreboardHTML;
            }
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        function resetGame() {
            nameDisplay.textContent = '';
            showScreen('registration');
        }
        
        function addQuestion() {
            const question = questionTextInput.value.trim();
            const answers = [];
            let hasEmptyAnswer = false;
            
            answerInputs.forEach(input => {
                const answer = input.value.trim();
                if (!answer) hasEmptyAnswer = true;
                answers.push(answer);
            });
            
            if (!question || hasEmptyAnswer) {
                alert('Please fill in the question and all answer fields!');
                return;
            }
            
            const correctAnswer = parseInt(correctAnswerSelect.value);
            
            questions.push({
                question,
                answers,
                correctAnswer
            });
            
            // Clear the inputs for next question
            questionTextInput.value = '';
            answerInputs.forEach(input => {
                input.value = '';
            });
            
            renderQuestionsList();
        }
        
        function renderQuestionsList() {
            questionsList.innerHTML = '';
            
            if (questions.length === 0) {
                questionsList.innerHTML = '<p>No questions added yet.</p>';
                return;
            }
            
            questions.forEach((q, index) => {
                const questionItem = document.createElement('div');
                questionItem.className = 'question-item';
                
                const title = document.createElement('h3');
                title.textContent = `Q${index + 1}: ${q.question}`;
                
                const correctAnswerText = document.createElement('p');
                correctAnswerText.innerHTML = `<span class="correct-answer">Correct Answer:</span> ${q.answers[q.correctAnswer]}`;
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-question';
                removeBtn.textContent = '×';
                removeBtn.addEventListener('click', () => removeQuestion(index));
                
                questionItem.appendChild(title);
                questionItem.appendChild(correctAnswerText);
                questionItem.appendChild(removeBtn);
                
                questionsList.appendChild(questionItem);
            });
        }
        
        function removeQuestion(index) {
            questions.splice(index, 1);
            renderQuestionsList();
        }
        
        // Add text size settings
        const textSizeSelect = document.getElementById('text-size');
        
        function updateTextSizes(size) {
            const sizes = {
                small: {
                    question: '2.8rem',
                    answer: '2.4rem'
                },
                medium: {
                    question: '3.2rem',
                    answer: '2.8rem'
                },
                large: {
                    question: '3.6rem',
                    answer: '3.2rem'
                }
            };
            
            document.getElementById('question-text').style.fontSize = sizes[size].question;
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.style.fontSize = sizes[size].answer;
            });
        }
        
        textSizeSelect.addEventListener('change', (e) => {
            updateTextSizes(e.target.value);
        });

        function saveSettings() {
            timePerQuestion = parseInt(timePerQuestionInput.value);
            
            if (isNaN(timePerQuestion) || timePerQuestion < 5 || timePerQuestion > 60) {
                alert('Please enter a valid time between 5 and 60 seconds.');
                return;
            }
            
            if (questions.length === 0) {
                alert('Please add at least one question before starting the quiz.');
                return;
            }

            // Save text size preference
            updateTextSizes(textSizeSelect.value);
            
            showScreen('registration');
        }
        
        // Add virtual keyboard functionality
        const nameDisplay = document.getElementById('name-display');
        const keys = document.querySelectorAll('.key');
        
        keys.forEach(key => {
            key.addEventListener('click', () => {
                if (key.classList.contains('delete')) {
                    nameDisplay.textContent = nameDisplay.textContent.slice(0, -1);
                } else if (!key.classList.contains('empty')) {
                    if (nameDisplay.textContent.length < 15) {
                        nameDisplay.textContent += key.textContent;
                    }
                }
                playerNameInput.value = nameDisplay.textContent;
            });
        });
        
        // Add event listener for close popup button
        document.getElementById('close-popup-btn').addEventListener('click', () => {
            document.getElementById('current-player-popup').classList.remove('active');
        });
        
        // Initialize the app
        renderQuestionsList();
    </script>
</body>
</html>